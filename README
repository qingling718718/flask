const key =
  periodMode === 'DAY'
    ? ['reservations', 'day', viewMode, date, idsStable]
    : null;

const { data: raw, isLoading, isValidating } = useSWR(
  key,
  async ([
    _namespace,  // 'reservations'
    _type,       // 'day'
    viewMode,
    date,
    ids,
  ]) => {
    // ⭐ 只有 key !== null 才会进来
    // 所以这里不用再判断 periodMode

    // ===== 日表示请求 =====
    const [{ data: { columns } }, { data: { dates } }] = await Promise.all([
      getMockData(
        viewMode === VIEW_MODE.STAFF ? staffDailyData : unitDailyData,
        1000,
      ),
      // 需要列周时再拉（如果你把列周也放进 key）
      getMockData(colWeeklyData, 500),
    ]);

    // ⭐ fetcher 只 return raw，不做任何副作用
    return {
      kind: 'day' as const,
      dailyColumns: columns,
      weeklyColumnData: ids.map(colId => ({
        colId,
        dates,
      })),
    };
  },
  {
    keepPreviousData: true,
    refreshInterval: 40000,
    revalidateOnFocus: true,
    shouldRetryOnError: false,
  }
);
